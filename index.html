<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="description" content="点击前往SetuTime~">
<title>SetuTime 合集 - 奈奈</title>
<style>
  body{margin:0;font-family:"Segoe UI","Helvetica Neue",Arial,sans-serif;background:#ffffff;color:#374151;min-height:100vh;font-size:15px;overflow-x:hidden}
  header, .container {opacity: 0;transform: translateY(15px);transition: opacity 0.5s ease-out, transform 0.5s ease-out}
  .loaded header, .loaded .container {opacity: 1;transform: translateY(0)}
  ul.list li {opacity: 0;transform: translateY(20px);transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.2, 0.8, 0.4, 1)}
  .loaded ul.list li {opacity: 1;transform: translateY(0)}
  .loaded ul.list li:nth-child(1) { transition-delay: 0.05s; }
  .loaded ul.list li:nth-child(2) { transition-delay: 0.10s; }
  .loaded ul.list li:nth-child(3) { transition-delay: 0.15s; }

  header{position:sticky;top:0;z-index:100;text-align:center;padding:1rem 0.5rem;transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);pointer-events: none}
  .capsule{display: inline-block;background:#ffffffcc;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-radius:999px;box-shadow:0 8px 32px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.6);max-width: 90vw;width: fit-content;min-width: 260px;margin:12px auto;padding:0.8rem 1.5rem;font-size:1.7rem;font-weight:700;color:#3b82f6;pointer-events: auto;box-sizing: border-box;transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1)}
  header.hidden .capsule {transform: translateY(-20px) scale(0.85);opacity: 0}

  .container{max-width:860px;margin:1.5rem auto;padding:0 1rem}
  .section-header-row {display: flex; align-items: center; justify-content: space-between; margin: 1.6rem 0 0.8rem;}
  .section-title{font-size:1.28rem;font-weight:600;padding-left:0.6rem;border-left:5px solid #3b82f6;color:#1e40af;margin:0}
  
  /* 搜索条样式调整：圆形、加深、加长 */
  .search-trigger-right {
    display: flex; 
    align-items: center; 
    background: #d1d5db; /* 加深灰色 */
    padding: 7px 18px; 
    border-radius: 999px; /* 圆形设计 */
    border: 1px solid #d1d5db; 
    cursor: pointer; 
    transition: 0.2s; 
    min-width: 220px; /* 加长搜索条 */
    justify-content: space-between;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
  }
  .search-trigger-right:hover {background: #d1d5db;}
  .search-trigger-right span {color: #6b7280; font-size: 0.9rem;}
  .search-trigger-right kbd {background: #fff; border: 1px solid #d1d5db; border-radius: 4px; padding: 1px 4px; font-size: 0.7rem; color: #9ca3af;}

  /* 极速线性扩散动画 (无回弹) */
  .search-overlay {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.35); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); z-index: 1000; justify-content: center; align-items: flex-start; padding-top: 12vh; opacity: 0; transition: opacity 0.1s ease-out;}
  .search-overlay.active {display: flex; opacity: 1;}
  .search-modal {width: 95%; max-width: 600px; background: #fff; border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; transform: scale(0.9); transition: transform 0.1s ease-out;}
  .search-overlay.active .search-modal {transform: scale(1);}
  .search-overlay.closing {opacity: 0;}
  .search-overlay.closing .search-modal {transform: scale(0.9);}

  .search-box {display: flex; align-items: center; padding: 15px 20px; border-bottom: 1px solid #f3f4f6}
  .search-box input {flex: 1; border: none; outline: none; font-size: 1.1rem; margin-left: 10px; color: #1f2937; background: transparent}
  .search-box .esc {font-size: 0.75rem; color: #9ca3af; border: 1px solid #e5e7eb; padding: 2px 6px; border-radius: 4px; cursor: pointer}
  .search-results {overflow-y: auto; max-height: 60vh; padding: 8px}
  .search-results .item {padding: 12px 16px; border-radius: 8px; cursor: pointer; transition: 0.1s; display: flex; flex-direction: column; gap: 4px;}
  .search-results .item:hover {background: #f3f8ff;}
  .search-results .item .title {font-weight: 700; color: #3b82f6; font-size: 0.95rem}
  .search-results .item .sub {font-size: 0.85rem; color: #4b5563; line-height: 1.4}

  @media (max-width: 600px) {
    .search-trigger-right { min-width: 140px; padding: 6px 12px; }
    .search-trigger-right kbd { display: none; }
    .section-title { font-size: 1.1rem; }
  }

  ul.list{list-style:none;padding:0;margin:0}
  ul.list li{background:#fff;border:1px solid #cbd5e1;border-radius:12px;padding:0.85rem 1rem;margin-bottom:0.7rem;box-shadow:0 4px 12px rgba(0,0,0,0.04);cursor:pointer;transition:all .25s;display:flex;align-items:center;gap:0.7rem;font-size:0.98rem}
  ul.list li:hover,ul.list li:active{transform:translateY(-2px);box-shadow:0 8px 20px rgba(59,130,246,0.15);border-color:#93bbfc;background:#f8faff}
  ul.list li .num{color:#3b82f6;font-weight:600;font-size:1rem;white-space:nowrap;flex-shrink:0}
  ul.list li .caption{color:#4b5563;font-size:0.88rem;opacity:0.9;line-height:1.4}
  .pagination{display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:0.5rem;margin:2.2rem 0 1rem}
  .pagination button{min-width:38px;height:38px;background:#ffffff;color:#5d8eff;border:none;border-radius:10px;font-size:0.9rem;font-weight:500;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 6px rgba(93,142,255,0.15)}
  .pagination button:hover{transform:translateY(-3px);box-shadow:0 6px 16px rgba(93,142,255,0.28);background:#f8fbff}
  .pagination button.active{background:linear-gradient(135deg,#a8c0ff,#e0e7ff);color:#2563eb;font-weight:600;box-shadow:0 0 0 3px rgba(168,192,255,0.4)}
  .page-info{color:#64748b;font-size:0.88rem;margin-top:1rem;text-align:center;font-weight:500}
  .update-time{font-size:0.8rem;color:#94a3b8;text-align:center;margin:2rem 0 1rem}
  .qq-button{margin: 18px auto 28px;text-align: center}
  .qq-button a{display: inline-block;width: calc(100% - 60px);max-width: 420px;background: linear-gradient(135deg, #60a5fa, #3b82f6);color: #fff;padding: 11px 0;border-radius: 999px;text-decoration: none;font-weight: 600;font-size: 0.98rem;box-shadow: 0 4px 12px rgba(92,168,230,.4);transition: .3s}
  .qq-button a:hover{background: linear-gradient(135deg, #4b96d8, #2563eb);transform: translateY(-2px)}
</style>
</head>
<body ontouchstart="">
<header id="header">
  <div class="capsule">奈奈的 SetuTime</div>
</header>

<div class="container">
  <div class="section-title">二次元</div>
  <div class="qq-button">
    <a href="https://ti.qq.com/open_qq/index2.html?url=mqqapi%3A%2F%2Fuserprofile%2Ffriend_profile_card%3Fsrc_type%3Dweb%26version%3D1.0%26source%3D2%26uin%3D51301105" target="_blank">qq：51301105 添加好友获取更新</a>
  </div>
  <ul class="list" id="setu-list">加载中...</ul>
  <div id="setu-pagination" class="pagination"></div>

  <div class="section-header-row">
    <div class="section-title">Cos写真</div>
    <div class="search-trigger-right" onclick="toggleSearch(true)">
      <span>搜索...</span>
      <kbd>Ctrl K</kbd>
    </div>
  </div>
  
  <div class="qq-button">
    <a href="https://ti.qq.com/open_qq/index2.html?url=mqqapi%3A%2F%2Fuserprofile%2Ffriend_profile_card%3Fsrc_type%3Dweb%26version%3D1.0%26source%3D2%26uin%3D45503380" target="_blank">qq：45503380 添加好友获取更新</a>
  </div>
  <ul class="list" id="zrsetu-list">加载中...</ul>
  <div id="zrsetu-pagination" class="pagination"></div>

  <div class="page-info" id="page-info"></div>
  <div class="update-time" id="update-time"></div>
</div>

<div id="searchOverlay" class="search-overlay" onclick="if(event.target==this)toggleSearch(false)">
  <div class="search-modal">
    <div class="search-box">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      <input type="text" id="searchInput" placeholder="搜索 Coser写真..." autocomplete="off">
      <div class="esc" onclick="toggleSearch(false)">Esc</div>
    </div>
    <div id="searchResults" class="search-results"></div>
  </div>
</div>

<script>
const rootUrl = './';
const ITEMS_PER_PAGE = 10;
const header = document.getElementById('header');
let lastScrollY = 0;
let ticking = false;
let allZrsetuItems = [];

function updateHeader() {
  const currentScrollY = window.scrollY;
  if (currentScrollY > lastScrollY && currentScrollY > 10) header.classList.add('hidden');
  else if (currentScrollY < lastScrollY || currentScrollY <= 10) header.classList.remove('hidden');
  lastScrollY = currentScrollY;
  ticking = false;
}

window.addEventListener('scroll', () => {
  if (!ticking) { requestAnimationFrame(updateHeader); ticking = true; }
});

async function loadData() {
  try {
    const res = await fetch(`${rootUrl}data.json?t=${Date.now()}`);
    if (!res.ok) throw new Error('Failed');
    return await res.json();
  } catch (e) {
    document.body.innerHTML = '<div style="text-align:center;margin-top:8rem;color:#e74c3c;">加载失败，请刷新重试</div>';
    throw e;
  }
}

function renderPage(items, containerId, paginationId, page = 1) {
  const container = document.getElementById(containerId);
  const pagination = document.getElementById(paginationId);
  const totalPages = Math.ceil(items.length / ITEMS_PER_PAGE);
  const start = (page - 1) * ITEMS_PER_PAGE;
  const pageItems = items.slice(start, start + ITEMS_PER_PAGE);

  container.innerHTML = '';
  pageItems.forEach(item => {
    const li = document.createElement('li');
    const num = item.file.match(/\d+/)?.[0] || '?';
    li.innerHTML = `<span class="num">第${num}期</span>${item.caption ? `<span class="caption">${item.caption}</span>` : ''}`;
    li.onclick = () => window.open(`${rootUrl}${containerId === 'setu-list' ? 'setu' : 'zrsetu'}/${item.file}`, '_blank');
    container.appendChild(li);
  });

  pagination.innerHTML = '';
  const prev = document.createElement('button');
  prev.textContent = '←';
  prev.disabled = page === 1;
  prev.onclick = () => page > 1 && renderPage(items, containerId, paginationId, page - 1);
  pagination.appendChild(prev);

  const maxBtns = 5;
  let startPage = Math.max(1, page - 2);
  let endPage = Math.min(totalPages, startPage + maxBtns - 1);
  if (endPage - startPage + 1 < maxBtns) startPage = Math.max(1, endPage - maxBtns + 1);
  for (let i = startPage; i <= endPage; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    if (i === page) btn.classList.add('active');
    btn.onclick = () => renderPage(items, containerId, paginationId, i);
    pagination.appendChild(btn);
  }

  const next = document.createElement('button');
  next.textContent = '→';
  next.disabled = page === totalPages;
  next.onclick = () => page < totalPages && renderPage(items, containerId, paginationId, page + 1);
  pagination.appendChild(next);
}

function toggleSearch(show) {
  const overlay = document.getElementById('searchOverlay');
  const input = document.getElementById('searchInput');
  if (show) {
    overlay.style.display = 'flex';
    setTimeout(() => overlay.classList.add('active'), 10);
    input.focus();
  } else {
    overlay.classList.add('closing');
    setTimeout(() => {
      overlay.classList.remove('active', 'closing');
      overlay.style.display = 'none';
      input.value = '';
      document.getElementById('searchResults').innerHTML = '';
    }, 110);
  }
}

document.getElementById('searchInput').oninput = function(e) {
  const val = e.target.value.toLowerCase().trim();
  const resultsDiv = document.getElementById('searchResults');
  if (!val) { resultsDiv.innerHTML = ''; return; }
  const matched = allZrsetuItems.filter(item => item.caption && item.caption.toLowerCase().includes(val));
  resultsDiv.innerHTML = matched.map(item => `
    <div class="item" onclick="window.open('${rootUrl}zrsetu/${item.file}', '_blank')">
      <div class="title">第${item.file.match(/\d+/)?.[0] || '?'}期</div>
      <div class="sub">${item.caption}</div>
    </div>
  `).join('');
};

window.onkeydown = (e) => {
  if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); toggleSearch(true); }
  if (e.key === 'Escape') toggleSearch(false);
};

window.onload = async () => {
  const data = await loadData();
  if (data.updated) document.getElementById('update-time').textContent = `最后更新：${data.updated}`;
  const sortDesc = arr => arr.sort((a,b) => (parseInt(b.file)||0) - (parseInt(a.file)||0));
  const setuItems = sortDesc(data.setu || []);
  allZrsetuItems = sortDesc(data.zrsetu || []);
  renderPage(setuItems, 'setu-list', 'setu-pagination', 1);
  renderPage(allZrsetuItems, 'zrsetu-list', 'zrsetu-pagination', 1);
  document.getElementById('page-info').innerHTML = `二次元 <b>${setuItems.length}</b> 期　　Cos写真 <b>${allZrsetuItems.length}</b> 期`;
  document.body.classList.add('loaded');
};
</script>
</body>
</html>
